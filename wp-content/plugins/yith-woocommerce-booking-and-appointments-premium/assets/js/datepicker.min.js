jQuery(function(m){"use strict";m.fn.yith_wcbk_datepicker=function(){var p={message:null,overlayCSS:{background:"#fff",opacity:.7},ignoreIfBlocked:!0},t=new Date,g=new Date(t.getFullYear(),t.getMonth(),t.getDate()),y=function(t){var a=t.data("type"),e=m(t.data("related-from"));return"to"===a&&0<e.length&&(t=e),t},b=function(t){return{all_day:(t=y(t)).data("all-day"),allow_same_date:t.data("allow-same-date")||"yes",ajax_load_months:t.data("ajax-load-months"),month_to_load:t.data("month-to-load"),year_to_load:t.data("year-to-load"),min_duration:t.data("min-duration"),notAvailableDates:t.data("not-available-dates")||[],product_id:t.data("product-id"),is_static:t.data("static")||"no"}};return m(this).each(function(){var r=m(this),e=r.parent(".yith-wcbk-date-range-picker"),c=r.data("type"),t=r.data("min-date"),a=r.data("max-date"),s=m(r.data("related-to")),o=m(r.data("on-select-open")),_=m(r.data("related-from")),i=r.next(".yith-wcbk-date-picker--formatted"),d=m(r.data("update-on-change")),u=!1,k="yes"===r.data("disable-after-non-available-date")&&"to"===c,h=function(){var e=b(r),o=y(r);m("#ui-datepicker-div").block(p),m.ajax({type:"POST",data:{product_id:e.product_id,month_to_load:e.month_to_load,year_to_load:e.year_to_load,action:"yith_wcbk_get_product_not_available_dates",security:bk.nonces.getProductNonAvailableDates},url:bk.ajaxurl,success:function(t){try{t.error?console.log(t.error):(o.data("month-to-load",t.month_to_load),o.data("year-to-load",t.year_to_load),o.data("not-available-dates",e.notAvailableDates.concat(t.not_available_dates)),m("#ui-datepicker-div").unblock(),r.datepicker("refresh"))}catch(a){console.log(a.message)}}})},n=function(t,a){a=a||0;var e,o,i=b(r);0<s.length&&(o="yes"===bk.settings.check_min_max_duration_in_calendar?i.min_duration:1,"yes"===i.allow_same_date&&--o,e=0<o?(e=yith_wcbk_dates.add_days_to_date(t,o)).getUTCFullYear()+"-"+(e.getUTCMonth()+1)+"-"+e.getUTCDate():t,s.val()&&yith_wcbk_dates.date_diff(s.val(),e)<0&&s.datepicker("setDate",null),a?setTimeout(function(){s.datepicker("option","minDate",e)},a):s.datepicker("option","minDate",e))};r.on("yith_wcbk_datepicker_load_non_available_dates",function(t,a){var e=b(r),o=y(r);m.ajax({type:"POST",data:{product_id:e.product_id,action:"yith_wcbk_get_product_not_available_dates",security:bk.nonces.getProductNonAvailableDates},url:bk.ajaxurl,success:function(t){try{t.error?console.log(t.error):(o.data("month-to-load",t.month_to_load),o.data("year-to-load",t.year_to_load),o.data("not-available-dates",t.not_available_dates),r.datepicker("refresh"))}catch(a){console.log(a.message)}},complete:function(){"undefined"!=typeof a.callback&&a.callback()}})}),r.datepicker({dateFormat:"yy-mm-dd",minDate:t,maxDate:a,showAnim:!1,showButtonPanel:!0,closeText:yith_wcbk_datepicker_params.i18n_clear,altField:i,altFormat:bk.settings.datepickerFormat,popup:{position:"bottom left",origin:"top left"},beforeShow:function(t,a){u=!1,r.addClass("yith-wcbk-datepicker--opened"),e.length&&(e.addClass("yith-wcbk-date-range-picker--opened"),c&&e.addClass("yith-wcbk-date-range-picker--opened-"+c)),m("#ui-datepicker-div").addClass("yith-wcbk-datepicker").addClass("notranslate"),"yes"===b(r).is_static&&m("#ui-datepicker-div").addClass("yith-wcbk-datepicker--static").appendTo(r.parent().parent()),a.yith_booking_date_selected=!1,setTimeout(function(){m(".ui-datepicker-close").on("click",function(){r.datepicker("setDate",null).trigger("change")})},10)},beforeShowDay:function(t){var a,e,o=!0,i=r.data("allowed-days")||[],d=b(r),n=[],l=!("to"!==c||!_.length)&&_.datepicker("getDate");return 15!==t.getDate()||function(t,a,e){e=b(r=e);if("yes"===e.ajax_load_months){a=t+"-"+a+"-01",e=e.year_to_load+"-"+e.month_to_load+"-01";if(yith_wcbk_dates.date_diff(a,e,"months")<1)return!0}return!1}(t.getFullYear(),t.getMonth()+1,r)&&h(),o&&k&&u&&t.getTime()>=u.getTime()&&(o=!1),o&&0<i.length&&(0===(e=t.getDay())&&(e=7),o=-1!==i.indexOf(e)),o&&0<d.notAvailableDates.length&&(a="yes"===bk.settings.check_min_max_duration_in_calendar?d.min_duration:1,"yes"===d.all_day&&--a,e="to"===c?yith_wcbk_dates.add_days_to_date(t,-a):t,e=yith_wcbk_dates.formatDate(e),o=-1===d.notAvailableDates.indexOf(e)),!o&&t.getTime()>g.getTime()&&(n.push("bk-non-available-date"),("to"!==c||l&&t.getTime()>l.getTime()+yith_wcbk_dates.DAY_IN_MILLISECONDS*a)&&(u=u||new Date(t))),"from"===c&&s.length&&yith_wcbk_dates.formatDate(t)===s.val()&&n.push("bk-to-date"),"to"===c&&_.length&&yith_wcbk_dates.formatDate(t)===_.val()&&n.push("bk-from-date"),[o,n.join(" ")]},onClose:function(t,a){m("#ui-datepicker-div").removeClass("yith-wcbk-datepicker").removeClass("notranslate"),"yes"===b(r).is_static&&m("#ui-datepicker-div").removeClass("yith-wcbk-datepicker--static").appendTo(m("body")),a.yith_booking_date_selected&&0<o.length&&!o.val()&&(o.trigger("focus"),setTimeout(function(){o.trigger("focus")},50)),r.removeClass("yith-wcbk-datepicker--opened"),e.length&&(e.removeClass("yith-wcbk-date-range-picker--opened"),c&&e.removeClass("yith-wcbk-date-range-picker--opened-"+c))},onSelect:function(t,a){t&&(n(t),a.yith_booking_date_selected=!0),m(this).trigger("change")}}),i.on("focus",function(){r.trigger("focus")});var i=r.parent().find(".yith-wcbk-booking-date-icon"),l=!1;i.on("mousedown",function(){l=!!r.datepicker("widget").is(":visible")}).on("click",function(){l||r.trigger("focus")}),r.is(".yith-wcbk-date-picker--inline")&&r.val(r.data("value")),r.val()&&(r.datepicker("setDate",r.val()+" 00:00:00"),n(r.val(),100)),d.length&&(r.on("change",function(){d.val(m(this).val())}),d.val(r.val()))})}});