jQuery(function(r){"use strict";var o={lastIndex:1,rulesContainer:!1,rulesList:!1,preNewRuleContainer:r("#yith-wcbk-price-rules__pre-new-rule"),expandCollapseButton:r(".yith-wcbk-price-rules__expand-collapse"),saveSettingsButton:r("#yith-wcbk-settings-tab-actions-save"),init:function(){this._initParams(),r(document).on("change yith_wcbk_admin_booking_price_rule_condition_type_change",".yith-wcbk-price-rule__condition__type",this.conditionTypeChanged),r(".yith-wcbk-price-rules__new-rule").on("click",this.preAddRule),this.preNewRuleContainer.on("click",".yith-wcbk-price-rules__add-rule",this.addRule),r(document).on("click",".yith-wcbk-price-rules__delete-rule",this.deleteRule),r("form#post, form#yith-wcbk-global-price-rules").on("submit",this.emptyPreAddRule),r(document).on("click",".yith-wcbk-price-rule__conditions__new-condition",this.addCondition),r(document).on("click",".yith-wcbk-price-rule__condition__delete-condition",this.deleteCondition),this.expandCollapseButton.on("click",this.expandCollapseAll),this.checkConditionVisibility(),this.expandCollapseVisibility()},_initParams:function(){this.rulesContainer=r(".yith-wcbk-price-rules").first(),this.rulesList=this.rulesContainer.find(".yith-wcbk-price-rules__list"),this.lastIndex=this.rulesList.find(".yith-wcbk-price-rule").length||0},nextIndex:function(){return++o.lastIndex},checkConditionVisibility:function(e){((e=e||r(".yith-wcbk-price-rule__condition__type")).is(".yith-wcbk-price-rule")||e.is(".yith-wcbk-price-rule__condition"))&&(e=e.find(".yith-wcbk-price-rule__condition__type")),e.trigger("yith_wcbk_admin_booking_price_rule_condition_type_change")},conditionTypeChanged:function(e){var i,t,e=r(e.target),n=e.val()||"custom",e=e.closest(".yith-wcbk-price-rule__condition"),o={custom:e.find(".yith-wcbk-price-rule__condition--show-if-custom"),month:e.find(".yith-wcbk-price-rule__condition--show-if-month"),week:e.find(".yith-wcbk-price-rule__condition--show-if-week"),day:e.find(".yith-wcbk-price-rule__condition--show-if-day"),time:e.find(".yith-wcbk-price-rule__condition--show-if-time input"),numeric:e.find(".yith-wcbk-price-rule__condition--show-if-numeric")},c=["custom","month","week","day","time","numeric"],l=function(e,i){return-1!==r.inArray(e,i)};if(l(n,["custom","month","week","day","time","numeric"])){for(i in c)n!==(t=c[i])&&(o[t].attr("disabled","disabled"),(l(t,["custom","time"])?o[t].parent():o[t]).hide());o[n].removeAttr("disabled"),(l(n,["custom","time"])?o[n].parent():o[n]).show()}else o.custom.attr("disabled","disabled"),o.month.attr("disabled","disabled"),o.week.attr("disabled","disabled"),o.day.attr("disabled","disabled"),o.time.attr("disabled","disabled"),o.custom.parent().hide(),o.month.hide(),o.week.hide(),o.day.hide(),o.time.parent().hide(),o.numeric.removeAttr("disabled"),o.numeric.show()},getRuleToAdd:function(){var e=o.preNewRuleContainer.find(".yith-wcbk-price-rule").first();return!!e.length&&e},emptyPreAddRule:function(){o.preNewRuleContainer.html("")},preAddRule:function(e){e.preventDefault();var i,t,n=r(e.target);o.getRuleToAdd()?o.preNewRuleContainer.is(".bk--open")?o.preNewRuleContainer.removeClass("bk--open").slideUp():o.preNewRuleContainer.addClass("bk--open").slideDown():(t=n.data("template"),e=o.nextIndex(),o.preNewRuleContainer.hide(),t=t.replace(new RegExp("{{INDEX}}","g"),e),t=r(t),o.preNewRuleContainer.append(t),t.find(".yith-wcbk-admin-date-picker").yith_wcbk_datepicker(),c.initOperators(t),l.initVisibility(t),o.checkConditionVisibility(t),r(document).trigger("yith_wcbk_product_metabox_dynamic_durations"),o.preNewRuleContainer.addClass("bk--open").slideDown()),o.preNewRuleContainer.is(".bk--open")&&(i=n.offset())&&i.top&&r("html, body").animate({scrollTop:i.top-n.outerHeight()-20})},addRule:function(e){e.preventDefault();e=r(this).closest(".yith-wcbk-price-rule");e.find(".yith-wcbk-price-rules__add-rule").remove(),o.rulesList.append(e),o.expandCollapseVisibility(),o.attentionForSaving()},deleteRule:function(e){e.preventDefault(),r(e.target).closest(".yith-wcbk-price-rule").animate({opacity:.3},200).delay(200).slideUp(300,function(){r(this).remove(),o.expandCollapseVisibility(),o.attentionForSaving()})},addCondition:function(e){e.preventDefault();var i=r(e.target),t=wp.template("yith-wcbk-price-rule-condition"),n=i.closest(".yith-wcbk-price-rule__conditions").find(".yith-wcbk-price-rule__conditions__list"),e=i.closest(".yith-wcbk-price-rule").data("index")||1,i=1;n.data("last-index")?i=n.data("last-index")+1:(i=n.find(".yith-wcbk-price-rule__condition").length||0,i+=1),n.data("last-index",i),i=r(t({ruleIndex:e,conditionIndex:i})),n.append(i),i.find(".yith-wcbk-admin-date-picker").yith_wcbk_datepicker(),o.checkConditionVisibility(i)},deleteCondition:function(e){e.preventDefault(),r(e.target).closest(".yith-wcbk-price-rule__condition").remove()},expandCollapseAll:function(e){var i=r(e.target).closest(".yith-wcbk-price-rules__expand-collapse"),e=o.rulesList;i.is(".yith-wcbk-price-rules__expand-collapse--collapse")?(i.removeClass("yith-wcbk-price-rules__expand-collapse--collapse"),e.find(".yith-wcbk-settings-section-box:not(.yith-wcbk-settings-section-box--closed) .yith-wcbk-settings-section-box__toggle").click()):(i.addClass("yith-wcbk-price-rules__expand-collapse--collapse"),e.find(".yith-wcbk-settings-section-box.yith-wcbk-settings-section-box--closed .yith-wcbk-settings-section-box__toggle").click())},expandCollapseVisibility:function(){o.rulesList.find(".yith-wcbk-price-rule").length?o.expandCollapseButton.show():o.expandCollapseButton.hide()},attentionForSaving:function(){o.saveSettingsButton.length&&(o.saveSettingsButton.removeClass("yith-wcbk-effect--wiggle"),o.saveSettingsButton.outerWidth(),o.saveSettingsButton.addClass("yith-wcbk-effect--wiggle"))}};o.init();var c={init:function(){r(document).on("change",".yith-wcbk-operator-and-amount-fields__operator",this.handleOperatorChange),this.initOperators()},initOperators:function(e){(e=void 0!==e?e:r(document)).find(".yith-wcbk-operator-and-amount-fields__operator").each(function(){c.handleOperatorChange.call(r(this))})},handleOperatorChange:function(){var e=r(this).closest(".yith-wcbk-operator-and-amount-fields"),i=e.data("currency-symbol"),t=e.find(".yith-wcbk-operator-and-amount-fields__symbol"),e=r(this).val();["add","sub","set-to"].includes(e)?t.html(i):["add-percentage","sub-percentage"].includes(e)?t.html("%"):t.html("")}};c.init();var l={init:function(){var e=this;r(document).on("change",".yith-wcbk-price-rule__base-fee-enabled input",e.toggleBaseFee),r(document).on("change",".yith-wcbk-price-rule__base-price-enabled input",e.toggleBasePrice),e.initVisibility()},initVisibility:function(e){(e=void 0!==e?e:r(document)).find(".yith-wcbk-price-rule__base-fee-enabled input").each(function(){l.toggleBaseFee.call(r(this))}),e.find(".yith-wcbk-price-rule__base-price-enabled input").each(function(){l.toggleBasePrice.call(r(this))})},_togglePrice:function(e,i){var t=e.closest(".yith-wcbk-price-rule").find(i),n=t.find("input, select");console.log({value:e.val(),_selector:i}),"yes"===e.val()?(n.prop("disabled",!1),t.show()):(n.prop("disabled",!0),t.hide())},toggleBaseFee:function(){l._togglePrice(r(this),".yith-wcbk-price-rule__base-fee-fields")},toggleBasePrice:function(){l._togglePrice(r(this),".yith-wcbk-price-rule__base-price-fields")}};l.init()});