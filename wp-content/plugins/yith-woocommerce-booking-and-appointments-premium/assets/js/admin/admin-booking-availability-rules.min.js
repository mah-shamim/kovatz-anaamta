!function(d,e){"use strict";var a=function(){d(document.body).trigger("wc-enhanced-select-init")},l={dom:{rulesContainer:d(".yith-wcbk-availability-rules").first(),rulesList:!1,newRuleButton:d(".yith-wcbk-availability-rules__new-rule"),preNewRuleContainer:d("#yith-wcbk-availability-rules__pre-new-rule"),expandCollapseButton:d(".yith-wcbk-availability-rules__expand-collapse"),saveSettingsButton:d("#yith-wcbk-settings-tab-actions-save"),form:d("form#post, form#yith-wcbk-global-availability")},indexes:{rules:1,dataRanges:1},templates:{rule:e.template("yith-wcbk-availability-rule")},hasTime:!1,_initParams:function(){this.dom.rulesList=this.dom.rulesContainer.find(".yith-wcbk-availability-rules__list"),this.indexes.rules=this.dom.rulesList.find(".yith-wcbk-availability-rule").length||0},init:function(){this._initParams(),d(document).on("change yith_wcbk_admin_booking_availability_rule_type_change",".yith-wcbk-availability-rule__type",this.handleTypeChange),this.dom.newRuleButton.on("click",this.preAddRule),this.dom.preNewRuleContainer.on("click",".yith-wcbk-availability-rule__add-rule",this.addRule),d(document).on("click",".yith-wcbk-availability-rule__delete-rule",this.deleteRule),this.dom.form.on("submit",this.emptyPreAddRule),this.dom.expandCollapseButton.on("click",this.expandCollapseAll),this.expandCollapseVisibility(),d(".yith-wcbk-availability-rule__type").each(function(){l.handleTypeChange.call(d(this))})},handleTypeChange:function(){var i=d(this).val(),e=d(this).closest(".yith-wcbk-availability-rule"),t=e.find(".bk_ar_enable_if_type_specific"),a=t.find("input, select, textarea"),l=e.find(".bk_ar_enable_if_type_generic"),n=l.find("input, select, textarea");"specific"===i?(t.prop("disabled",!1),a.prop("disabled",!1),l.attr("disabled","disabled"),n.attr("disabled","disabled"),e.removeClass("yith-wcbk-availability-rule--generic-type").addClass("yith-wcbk-availability-rule--specific-type")):(l.prop("disabled",!1),n.prop("disabled",!1),t.attr("disabled","disabled"),a.attr("disabled","disabled"),e.removeClass("yith-wcbk-availability-rule--specific-type").addClass("yith-wcbk-availability-rule--generic-type"))},getRuleToAdd:function(){var i=l.dom.preNewRuleContainer.find(".yith-wcbk-availability-rule").first();return!!i.length&&i},emptyPreAddRule:function(){l.dom.preNewRuleContainer.html("")},preAddRule:function(i){i.preventDefault();var e,t=d(i.target);l.getRuleToAdd()?l.dom.preNewRuleContainer.is(".bk--open")?l.dom.preNewRuleContainer.removeClass("bk--open").slideUp():l.dom.preNewRuleContainer.addClass("bk--open").slideDown():(i=l.nextIndex(),l.dom.preNewRuleContainer.hide(),i=d(l.templates.rule({ruleIndex:i})),l.dom.preNewRuleContainer.append(i),i.find(".yith-wcbk-admin-date-picker").yith_wcbk_datepicker(),a(),l.handleTypeChange.call(i.find(".yith-wcbk-availability-rule__type")),l.dom.preNewRuleContainer.addClass("bk--open").slideDown()),l.dom.preNewRuleContainer.is(".bk--open")&&(e=t.offset())&&e.top&&d("html, body").animate({scrollTop:e.top-t.outerHeight()-20})},addRule:function(i){i.preventDefault();i=d(this).closest(".yith-wcbk-availability-rule");i.find(".yith-wcbk-availability-rules__add-rule").remove(),l.dom.rulesList.append(i),l.expandCollapseVisibility(),l.attentionForSaving()},deleteRule:function(i){i.preventDefault(),d(i.target).closest(".yith-wcbk-availability-rule").animate({opacity:.3},200).delay(200).slideUp(300,function(){d(this).remove(),l.expandCollapseVisibility(),l.attentionForSaving()})},nextIndex:function(){return++l.indexes.rules},expandCollapseAll:function(i){var e=d(i.target).closest(".yith-wcbk-availability-rules__expand-collapse"),i=l.dom.rulesList;e.is(".yith-wcbk-availability-rules__expand-collapse--collapse")?(e.removeClass("yith-wcbk-availability-rules__expand-collapse--collapse"),i.find(".yith-wcbk-settings-section-box:not(.yith-wcbk-settings-section-box--closed) .yith-wcbk-settings-section-box__toggle").click()):(e.addClass("yith-wcbk-availability-rules__expand-collapse--collapse"),i.find(".yith-wcbk-settings-section-box.yith-wcbk-settings-section-box--closed .yith-wcbk-settings-section-box__toggle").click())},expandCollapseVisibility:function(){l.dom.rulesList.find(".yith-wcbk-availability-rule").length?l.dom.expandCollapseButton.show():l.dom.expandCollapseButton.hide()},attentionForSaving:function(){l.dom.saveSettingsButton.length&&(l.dom.saveSettingsButton.removeClass("yith-wcbk-effect--wiggle"),l.dom.saveSettingsButton.outerWidth(),l.dom.saveSettingsButton.addClass("yith-wcbk-effect--wiggle"))}};l.init();var i=function(o){var i={template:"",selectors:{main:!1,wrap:!1,list:!1,row:!1,add:!1,remove:!1},indexes:{main:"ruleIndex",row:"availabilityIndex"},filterNewRowData:!1,onAddRow:!1,beforeDeleteRow:!1,onDeleteRow:!1};(o=d.extend({},i,o)).selectors=d.extend({},i.selectors,o.selectors),o.indexes=d.extend({},i.indexes,o.indexes);var a={};a.template=e.template(o.template),a._init=function(){d(document).on("click",o.selectors.add,a.addRow),d(document).on("click",o.selectors.remove,a.deleteRow)},a.getRelatedData=function(i){var e=i.target?d(i.target):d(i),t=!!o.selectors.main&&e.closest(o.selectors.main),a=t?t.find(o.selectors.wrap):e.closest(o.selectors.wrap),l=a.find(o.selectors.list),n=l.find(o.selectors.row),i=Math.max.apply(null,n.get().map(function(i){return parseInt(d(i).data("index"),10)})),e={};t&&(e[o.indexes.main]=t.data("index")),e[o.indexes.row]=i+1;a={main:t,wrap:a,list:l,rows:n,add:a.find(o.selectors.add)};return"function"==typeof o.filterNewRowData&&(e=o.filterNewRowData(d.extend({},e),d.extend({},a))),{dom:a,newRowData:e}},a.addRow=function(i){var e=a.getRelatedData(i),i=d(a.template(e.newRowData));e.dom.list.append(i),"function"==typeof o.onAddRow&&o.onAddRow(i,a.getRelatedData(i))},a.deleteRow=function(i){var e=!0,t=d(this).closest(o.selectors.row),i=a.getRelatedData(i);"function"==typeof o.beforeDeleteRow&&(e=o.beforeDeleteRow(t,i)),e&&(t.remove(),"function"==typeof o.onDeleteRow&&o.onDeleteRow(t,a.getRelatedData(i.dom.wrap)))},a._init()},t=function(i,e){a();var t=i.find(".yith-wcbk-availability__day");t.val("").trigger("change"),8<=e.dom.rows.length&&e.dom.add.hide();e=t.find("option:not(:disabled)").first().val()||!1;e?t.val(e).trigger("change"):i.remove()},n=function(i,e){e.dom.rows.first().find(".yith-wcbk-availability__day").trigger("change"),e.dom.add.show()};i({template:"yith-wcbk-availability-rule-date-range",selectors:{main:".yith-wcbk-availability-rule",wrap:".yith-wcbk-availability-rule__date-ranges",list:".yith-wcbk-availability-rule__date-ranges__list",row:".yith-wcbk-availability-rule__date-range",add:".yith-wcbk-availability-rule__date-ranges__add-range",remove:".yith-wcbk-availability-rule__date-range__action--delete"},indexes:{main:"ruleIndex",row:"dateRangeIndex"},onAddRow:function(i,e){l.handleTypeChange.call(e.dom.main.find(".yith-wcbk-availability-rule__type")),i.find(".yith-wcbk-admin-date-picker").yith_wcbk_datepicker(),a()}}),i({template:"yith-wcbk-availability-rule-availability",selectors:{main:".yith-wcbk-availability-rule",wrap:".yith-wcbk-availability-rule__availabilities",list:".yith-wcbk-availability-rule__availabilities__list",row:".yith-wcbk-availability-rule__availability",add:".yith-wcbk-availability-rule__availabilities__add-availability",remove:".yith-wcbk-availability-rule__availability__action--delete"},indexes:{main:"ruleIndex",row:"availabilityIndex"},onAddRow:t,onDeleteRow:n,beforeDeleteRow:function(i,e){return"all-day"===i.find(".yith-wcbk-availability__full-day-type").val()}}),i({template:"yith-wcbk-availability-rule-availability-time-slot",selectors:{main:".yith-wcbk-availability-rule__availability",wrap:".yith-wcbk-availability__time-slots",list:".yith-wcbk-availability__time-slots__list",row:".yith-wcbk-availability__time-slot",add:".yith-wcbk-availability-rule__availability__time-slots__add-time-slot",remove:".yith-wcbk-availability-rule__availability__time-slot__action--delete"},indexes:{main:"availabilityIndex",row:"timeSlotIndex"},onAddRow:function(){a()},filterNewRowData:function(i,e){return i.ruleIndex=e.main.closest(".yith-wcbk-availability-rule").data("index"),i},beforeDeleteRow:function(i,e){return!(e.dom.rows.length<2)||(e.dom.main.find(".yith-wcbk-availability__full-day-type").val("all-day").trigger("change"),!1)}}),{init:function(){d(document).on("change",".yith-wcbk-availability__full-day-type",this.fullDayTypeChangeHandler),d(document).on("change",".yith-wcbk-availability__day",this.dayChangeHandler)},fullDayTypeChangeHandler:function(){var i=d(this).closest(".yith-wcbk-availability"),e=i.find(".yith-wcbk-availability__time-slots"),t=e.find(".yith-wcbk-availability__time-slots__list").find("input"),a=d(this).val();i.attr("data-full-day-type",a),"all-day"===a?(e.hide(),t.prop("disabled",!0)):(e.show(),t.prop("disabled",!1))},dayChangeHandler:function(){var i=d(this).closest(".yith-wcbk-availability").parent().find(".yith-wcbk-availability__day"),a=i.map(function(){return d(this).val()}).toArray();i.each(function(){var e=d(this).val(),t=a.filter(function(i){return i!==e}),i=d(this).find("option");i.prop("disabled",!1),i.each(function(){var i=d(this);0<=t.indexOf(i.val())&&i.prop("disabled",!0)})})}}.init(),i({template:"yith-wcbk-default-availability",selectors:{main:!1,wrap:".yith-wcbk-default-availabilities",list:".yith-wcbk-default-availabilities__list",row:".yith-wcbk-default-availabilities__availability",add:".yith-wcbk-default-availabilities__actions__add-availability",remove:".yith-wcbk-default-availabilities__availability__action--delete"},indexes:{row:"availabilityIndex"},onAddRow:t,onDeleteRow:n,beforeDeleteRow:function(i,e){return"all-day"===i.find(".yith-wcbk-availability__full-day-type").val()}}),i({template:"yith-wcbk-default-availability-time-slot",selectors:{main:".yith-wcbk-availability",wrap:".yith-wcbk-availability__time-slots",list:".yith-wcbk-availability__time-slots__list",row:".yith-wcbk-availability__time-slot",add:".yith-wcbk-default-availabilities__availability__time-slots__add-time-slot",remove:".yith-wcbk-default-availabilities__availability__time-slot__action--delete"},indexes:{main:"availabilityIndex",row:"timeSlotIndex"},onAddRow:function(){a()},beforeDeleteRow:function(i,e){return!(e.dom.rows.length<2)||(e.dom.main.find(".yith-wcbk-availability__full-day-type").val("all-day").trigger("change"),!1)}})}(jQuery,wp);