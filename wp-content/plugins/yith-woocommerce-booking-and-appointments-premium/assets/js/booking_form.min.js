jQuery(function(f){"use strict";var p=function(o){return Math.abs(parseInt(o,10))||0},_=function(){var o,t=arguments[0],e=Array.prototype.slice.call(arguments).slice(1);for(o in e)var i=e[o],t=t.replace("%s",i);return t},g=function(){return Array.prototype.slice.call(arguments).filter(function(o){return o.length}).shift()},l=bk.blockParams,t=bk.blockParamsEmpty,u="on-form-update"===yith_booking_form_params.form_error_handling,e="on-button-click"===yith_booking_form_params.form_error_handling,h=function(o,t){var e,i,a="";return t in bk.i18n_durations&&(a=_((e=bk.i18n_durations[t].singular,i=bk.i18n_durations[t].plural,t=o,(t=isNaN(t)?0:t)<2?e:i),o)),a},k=function(o,t){return"string"==typeof t&&(t=[t]),void 0!==o.find(function(o){return-1<t.indexOf(o.key)})};f.fn.yith_booking_form=function(){var c={form:f(this).closest(".yith-wcbk-booking-form"),dom:{},ajaxCall:null};c.productID=c.form.data("product-id"),c.bookingData=c.form.data("booking_data"),c.dom={duration:c.form.find(".yith-wcbk-booking-duration"),realDuration:c.form.find(".yith-wcbk-booking-real-duration"),persons:c.form.find(".yith-wcbk-booking-persons"),personTypes:c.form.find(".yith-wcbk-booking-person-types"),optionalServices:c.form.find("input[type=checkbox].yith-wcbk-booking-service"),serviceQuantities:c.form.find("input.yith-wcbk-booking-service-quantity"),startDate:c.form.find(".yith-wcbk-booking-start-date"),from:c.form.find(".yith-wcbk-booking-hidden-from"),endDate:c.form.find(".yith-wcbk-booking-end-date"),message:c.form.find(".yith-wcbk-booking-form-message"),totals:c.form.find(".yith-wcbk-booking-form-totals"),totalsSection:c.form.find(".yith-wcbk-form-section-totals"),additionalData:c.form.find(".yith-wcbk-booking-form-additional-data"),time:c.form.find(".yith-wcbk-booking-start-date-time"),addToCart:c.form.closest("form").find("button[type=submit]"),addToQuote:f(".add-request-quote-button").first(),prices:c.form.closest(yith_booking_form_params.dom.product_container).find(yith_booking_form_params.dom.price)},c.dom.price="yes"!==yith_booking_form_params.price_first_only?c.dom.prices:c.dom.prices.first(),c.dom.timeWrap=c.dom.time.closest(".yith-wcbk-form-section"),c.getDuration=function(){return c.bookingData.duration},c.getDurationUnit=function(){return c.bookingData.duration_unit},c.getMinimumDuration=function(){return c.bookingData.minimum_duration},c.getMaximumDuration=function(){return c.bookingData.maximum_duration},c.getMinimumPeople=function(){return c.bookingData.minimum_number_of_people},c.getMaximumPeople=function(){return c.bookingData.maximum_number_of_people},c.getFormattedDuration=function(o){return h(o,c.getDurationUnit())},c.hasDuration=function(){return!!c.dom.duration.length},c.isDurationUnit=function(o){return"string"==typeof o?o===c.getDurationUnit():o.includes(c.getDurationUnit())},c.isFullDay=function(){return"yes"===c.bookingData.full_day},c.hasTime=function(){return c.isDurationUnit(["hour","minute"])},c.hasPeople=function(){return!!c.dom.persons.length||c.hasPersonTypes()},c.hasPersonTypes=function(){return!!c.dom.personTypes.length},c.hasOptionalServices=function(){return!!c.dom.optionalServices.length},c.updateTotalsHtml=function(o){o?c.dom.totalsSection.show():c.dom.totalsSection.hide(),c.dom.totals.html(o)},c.updateMessageHtml=function(o){o?c.dom.message.show():c.dom.message.hide(),c.dom.message.html(o)};var a=function(){c.form.find(".yith-wcbk-booking-form-error").remove(),c.form.find(".yith-wcbk-form-section__content--with-error").removeClass("yith-wcbk-form-section__content--with-error")},n=function(o){for(var t in a(),o){var e,i=o[t];i.message&&i.field&&(e=f('<div class="yith-wcbk-booking-form-error">'+i.message+"</div>"),i.field.closest(".yith-wcbk-form-section__content").addClass("yith-wcbk-form-section__content--with-error").append(e))}},r=function(){var o,t,e=p(c.dom.duration.val()),i=p(c.dom.persons.val()),a=c.dom.startDate.val(),n=a,r=c.dom.endDate.val(),m=i,d=c.dom.time.val(),s=!0,l={},u=[];return c.dom.from.length&&(d?c.dom.from.val(a+" "+d):c.dom.from.val(a),n=c.dom.from.val()),c.hasPersonTypes()&&(m=0,c.dom.personTypes.each(function(){m+=f(this).val()<1?0:parseInt(f(this).val(),10)})),c.hasDuration()&&!e&&(u.push({key:"empty-duration",field:c.dom.duration,message:yith_booking_form_params.i18n_empty_duration}),s=!1),n&&r&&c.isDurationUnit("day")&&(e=yith_wcbk_dates.date_diff(r,n,"days"),c.isFullDay()&&(e+=1)),(!a||0<c.dom.endDate.length&&!r)&&(c.hasTime()?u.push({key:"empty-date-for-time",field:c.dom.startDate,message:yith_booking_form_params.i18n_empty_date_for_time}):u.push({key:"empty-date",field:g(c.dom.endDate,c.dom.startDate),message:yith_booking_form_params.i18n_empty_date}),s=!1),c.hasTime()&&a&&!d&&(u.push({key:"empty-time",field:c.dom.time,message:yith_booking_form_params.i18n_empty_time}),s=!1),c.hasPeople()&&(m<c.getMinimumPeople()&&(u.push({key:"minimum-people",field:c.hasPersonTypes()?c.dom.personTypes.last():c.dom.persons,message:_(yith_booking_form_params.i18n_min_persons,c.getMinimumPeople())}),s=!1),0<c.getMaximumPeople()&&m>c.getMaximumPeople()&&(u.push({key:"maximum-people",field:c.hasPersonTypes()?c.dom.personTypes.last():c.dom.persons,message:_(yith_booking_form_params.i18n_max_persons,c.getMaximumPeople())}),s=!1)),0<c.getMinimumDuration()&&e<c.getMinimumDuration()&&(k(u,["empty-duration","empty-date"])||u.push({key:"minimum-duration",field:g(c.dom.duration,c.dom.endDate,c.dom.startDate),message:_(yith_booking_form_params.i18n_min_duration,c.getFormattedDuration(c.getMinimumDuration()))}),s=!1),c.getMaximumDuration()&&e>c.getMaximumDuration()&&(k(u,["empty-duration","empty-date"])||u.push({key:"maximum-duration",field:g(c.dom.duration,c.dom.endDate,c.dom.startDate),message:_(yith_booking_form_params.i18n_max_duration,c.getFormattedDuration(c.getMaximumDuration()))}),s=!1),s&&(o=[],t=[],c.hasPersonTypes()&&c.dom.personTypes.each(function(){o.push({id:f(this).data("person-type-id"),number:f(this).val()})}),c.hasOptionalServices()&&c.dom.optionalServices.each(function(){f(this).is(":checked")&&t.push(f(this).data("service-id"))}),l={product_id:c.productID,duration:e,from:n,time:d,to:r,persons:i,person_types:o,booking_services:t,action:"yith_wcbk_get_booking_data",context:"frontend",security:bk.nonces.getBookingData},c.dom.serviceQuantities.length&&c.dom.serviceQuantities.each(function(){var o=f(this).attr("name"),t=f(this).val();o.length&&(l[o]=t)}),c.dom.additionalData.length&&c.dom.additionalData.each(function(){var o=f(this).attr("name"),t=f(this).val();o.length&&(l[o]=t)})),{errors:u,validation:s,formData:l}},m=function(o){o?(c.dom.addToCart.removeClass("yith-wcbk-not-allowed"),c.dom.addToQuote.removeClass("yith-wcbk-not-allowed")):(c.dom.addToCart.addClass("yith-wcbk-not-allowed"),c.dom.addToQuote.addClass("yith-wcbk-not-allowed")),!u||o?(c.dom.addToCart.attr("disabled",!1),c.dom.addToQuote.removeClass("disabled")):(c.dom.addToCart.attr("disabled",!0),c.dom.addToQuote.addClass("disabled"))},d=function(o){o?(c.dom.totals.html()&&c.dom.totals.block(l),c.dom.message.html()&&c.dom.message.block(l),c.dom.price.block(l),c.dom.addToCart.block(t),c.dom.addToQuote.block(t)):(c.dom.message.unblock(),c.dom.price.unblock(),c.dom.addToCart.unblock(),c.dom.addToQuote.unblock())},o=function(o){f(this).is(".yith-wcbk-not-allowed")&&o.preventDefault(),e&&(a(),(o=r()).validation||n(o.errors))},i=function(t){t=void 0!==t?t:{},t=f.extend({},{updateFormOnCompleteOnlyIfValid:!1},t);var o=!1,e=c.dom.duration.val(),i=c.dom.startDate.val(),a=c.dom.time.val();return c.hasTime()&&i&&e&&(c.dom.time.parent().block(l),i={product_id:c.productID,duration:e,from:i,action:"yith_wcbk_get_booking_available_times",context:"frontend",security:bk.nonces.getAvailableTimes},c.ajaxCall&&c.ajaxCall.abort(),o=!0,c.ajaxCall=f.ajax({type:"POST",data:i,url:yith_booking_form_params.ajaxurl,success:function(o){try{var t;o.error?c.dom.message.html('<p class="error">'+o.error+"</p>"):(o.time_data_html&&c.dom.time.html(o.time_data_html),!a||(t=c.dom.time.find('option[value="'+a+'"]'))&&t.attr("selected","selected"),o.message&&c.dom.message.html("<p>"+o.message+"</p>"),c.form.trigger("yith_wcbk_form_update_time",o))}catch(e){console.log(e)}},complete:function(){c.dom.time.parent().unblock();var o=r();t.updateFormOnCompleteOnlyIfValid&&!o.validation||c.form.trigger("yith_wcbk_booking_form_update")}})),o},s=function(){c.hasTime()&&(c.dom.startDate.val()?c.dom.timeWrap.show():c.dom.timeWrap.hide())};c.updateTotalsHtml(""),m(!1),c.dom.addToCart.on("click",o),c.dom.addToQuote.on("click",o),c.dom.realDuration.on("change",function(){var o=Math.floor(c.dom.realDuration.val()/c.getDuration());c.dom.duration.val(o).trigger("change")}),c.form.on("yith_wcbk_booking_form_update",function(o,t){var e=c.form.find(".yith-wcbk-booking-form-error").length,i=r();t=void 0!==t?t:{},a(),i.validation?(d(!0),i.formData.action="yith_wcbk_get_booking_data",i.formData.context="frontend",i.formData.security=bk.nonces.getBookingData,c.ajaxCall&&c.ajaxCall.abort(),c.ajaxCall=f.ajax({type:"POST",data:i.formData,url:yith_booking_form_params.ajaxurl,success:function(o){try{o.error?c.updateMessageHtml('<p class="error">'+o.error+"</p>"):(o.message?c.updateMessageHtml(o.message):c.updateMessageHtml(""),o.totals_html?c.updateTotalsHtml(o.totals_html):c.updateTotalsHtml(""),o.price&&0<o.price.length&&c.dom.price.html(o.price),m(!!o.is_available),c.form.trigger("yith_wcbk_form_update_response",o))}catch(t){console.log(t.message)}},complete:function(o,t){"abort"!==t&&d(!1)}})):(c.updateMessageHtml(""),c.updateTotalsHtml(""),(e||function(o){if(u){o="undefined"!=typeof o.target&&o.target;return o&&o.is(".yith-wcbk-booking-start-date")&&c.dom.endDate.length&&!c.dom.endDate.val()?!1:!0}return!1}(t))&&n(i.errors),m(!1))}),c.form.on("yith_wcbk_booking_form_loaded",function(){var o=!i({updateFormOnCompleteOnlyIfValid:!0});s(),o&&r().validation&&c.form.trigger("yith_wcbk_booking_form_update")}),c.form.on("change","input, select, .yith-wcbk-date-picker--inline",function(o){var t=f(o.target),e=!0;t.is(".yith-wcbk-booking-real-duration")||(s(),(t.is(".yith-wcbk-booking-start-date")||t.is(".yith-wcbk-booking-duration"))&&(e=!i()),e&&c.form.trigger("yith_wcbk_booking_form_update",[{target:t,event:o}]))}),!yith_booking_form_params.is_admin&&"yes"===yith_booking_form_params.ajax_update_non_available_dates_on_load&&c.dom.startDate.is(".yith-wcbk-date-picker")?(c.dom.startDate.parent().block(l),c.dom.startDate.trigger("yith_wcbk_datepicker_load_non_available_dates",{callback:function(){c.dom.startDate.parent().unblock(),c.form.trigger("yith_wcbk_booking_form_loaded")}})):c.form.trigger("yith_wcbk_booking_form_loaded")},f(document).on("yith-wcbk-init-booking-form",function(){var o=f(".yith-wcbk-date-picker"),t=f(".yith-wcbk-booking-form"),e=f(".yith-wcbk-people-selector"),i=f(".yith-wcbk-month-picker-wrapper");o.yith_wcbk_datepicker(),i.yith_wcbk_monthpicker(),e.each(function(){f(this).yith_wcbk_people_selector()}),t.each(function(){f(this).yith_booking_form()}),f(document).trigger("yith-wcbk-booking-form-initialized")}).trigger("yith-wcbk-init-booking-form"),f(document).on("qv_loader_stop",function(){f(document).trigger("yith-wcbk-init-booking-form")})});