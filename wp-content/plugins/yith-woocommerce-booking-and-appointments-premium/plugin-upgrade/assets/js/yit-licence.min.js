!function(e){var t=e("body"),i=(e(document),e("#yith-license-activation")),n=e(i).find(".error-message.email"),a=e(i).find(".error-message.license-key"),c=i.find(".user-email"),u=i.find(".licence-key");e.yith_license_animation=function(t,i,n){var a=e("#licence-check-section-wrapper"),c=e("#no-license-enabled-message"),u=e("#yith-no-license-to-enabled-message"),o=e("#yith-license-from-wrapper");if("beforeSend"==n)t.animate({opacity:.4},100),i.addClass("show");else if("afterSend"==n)t.animate({opacity:1},100),i.removeClass("show");else if("removeLine"==n){var r=t.parent("tbody").find("tr");0===e("#yith-products-list").find("option").length&&(o.fadeIn(),u.fadeOut()),1==r.length?(c.fadeIn(),a.fadeOut(),t.remove()):t.fadeOut(),i.removeClass("show")}else if("addLine"==n){r=t.parent("tbody").find("tr");1===e("#yith-products-list").find("option").length&&(o.fadeOut(),u.fadeIn()),1==r.length&&(t.show(),t=a,c.fadeOut()),t.fadeIn(),i.removeClass("show")}};var o=function(t){t.off("click").on("click",function(t){if(t.preventDefault(),1==(1==script_info.is_debug||confirm(licence_message.are_you_sure))){var n=e(this),a=n.parent("td").parent("tr"),c=n.data("product-init"),u=n.data("product-id"),o=n.data("action"),s=e("#yith-licence-notice-wrapper"),d=e("#yith-licence-notice"),l=e("#activated-products").find(".spinner");jQuery.ajax({type:"POST",url:ajaxurl,data:{action:o,product_init:c,product_id:u},beforeSend:function(){e.yith_license_animation(a,l,"beforeSend")},success:function(t){var c,u,o,p,f,F,_;0==t?(d.find("p.yith-licence-notice-message").html(licence_message.server),s.fadeIn()):(0==t.activated&&(e.yith_license_animation(a,l,"removeLine"),c=n,u=e("#yith-products-list"),o=c.data("textdomain"),p=c.data("product-init"),f=c.data("marketplace"),F=c.data("displayname"),_=e('<option data-textdomain="'+o+'" data-init="'+p+'" data-marketplace="'+f+'">'+F+"</option>"),u.append(_),product_count=i.data("count"),i.removeClass("count-"+product_count),product_count=1*product_count+1,i.data("count",product_count).addClass("count-"+product_count),1==product_count||0==product_count?(products_list.attr("disabled",!0),e(".yith-select-plugin").text(licence_message.choose_the_plugin_singular)):(products_list.attr("disabled",!1),e(".yith-select-plugin").text(licence_message.choose_the_plugin_plural)),r()),"undefined"!=typeof t.error&&(d.find("p.yith-licence-notice-message").html(t.error),s.fadeIn()))}})}})};t.on("focusout","input.user-email",function(){var e,t=i.find(".user-email"),a=t.val().trim();if(t.val(a),""===a||(e=a,!new RegExp(/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i).test(e))){var u,o=licence_message.email;u=licence_message.error.replace("%field%",o)+".</br>"+licence_message.be_sure+".",n.html(u),n.addClass("visible"),c.addClass("require error")}}).on("focusout","input.licence-key",function(){var e,t=i.find(".licence-key"),n=t.val().trim(),c=new Array;if(t.val(n),""===n||(e=n,!new RegExp(/^[a-zA-Z0-9]{8}-[a-zA-Z0-9]{4}-[a-zA-Z0-9]{4}-[a-zA-Z0-9]{4}-[a-zA-Z0-9]{12}$/g).test(e))){c[c.length]=licence_message.license_key;var o=licence_message.license_key;a.text(licence_message.error.replace("%field%",o)),a.addClass("visible"),u.addClass("require error")}});var r=function(){var s=e(".licence-activation"),d=e(".licence-check"),l=e(".licence-deactive"),p=e(".remove-expired-plugin");t=e("body"),e(document),i=e("#yith-license-activation"),n=i.find(".error-message.email"),a=i.find(".error-message.license-key"),c=i.find(".user-email"),u=i.find(".licence-key"),products_list=e("#yith-products-list"),product_count=i.data("count"),function(i){i.off("click").on("click",function(i,o){i.preventDefault(),e(this);var s,d=e("#yith-license-activation"),l=e("#yith-products-list"),p=l.find("option:selected"),f=p.data("init"),F=p.data("marketplace"),_=e("#yith-licence-notice-wrapper"),m=e("#yith-licence-notice"),h=e("#products-to-active").find(".spinner"),y=!1,v=e("#licence-check-update");e("#product_init").val(f),e("#marketplace").val(F),s=d.serialize(),n.add(a).empty(),n.add(a).removeClass("visible"),email_check=t.find("input.licence-key").trigger("focusout"),license_key_check=t.find("input.user-email").trigger("focusout"),(email_check.hasClass("error")||license_key_check.hasClass("error"))&&(y=!0),!1===y?jQuery.ajax({type:"POST",url:"undefined"!=typeof ajaxurl?ajaxurl:yith_ajax.url,data:s,beforeSend:function(){e.yith_license_animation(d,h,"beforeSend")},success:function(t){if(e.yith_license_animation(d,h,"afterSend"),!0===t.activated){var i=e("#yith-enabled-license"),o=e(t.template);i.find("tbody").prepend(o),o.hide(),e("html, body").animate({scrollTop:v.offset().top},500).promise().done(function(){c.add(u).attr("value",""),p.remove(),product_count=d.data("count"),console.log(product_count),d.removeClass("count-"+product_count),product_count=1*product_count-1,d.data("count",product_count).addClass("count-"+product_count),1==product_count||0==product_count?(l.attr("disabled",!0),e(".yith-select-plugin").text(licence_message.choose_the_plugin_singular)):(l.attr("disabled",!1),e(".yith-select-plugin").text(licence_message.choose_the_plugin_plural))}),e.yith_license_animation(o,h,"addLine"),m.find("p.yith-licence-notice-message").html(t.activation_message),_.fadeIn(),r()}else!1!==t?(a.text(t.error),n.add(a).addClass("visible"),d.addClass("error")):(a.text(licence_message.server),a.addClass("visible"),d.addClass("error"));"undefined"!=typeof t.debug&&console.log(t.debug)}}):e.yith_license_animation(d,h,"afterSend")})}(s),function(t){t.off("click").on("click",function(t){t.preventDefault(),e(this);var i=e("#licence-check-update"),n=e("#yith-enabled-license"),a=i.serialize();jQuery.ajax({type:"POST",url:ajaxurl,data:a,beforeSend:function(){e.yith_license_animation(n,i.find("div.spinner"),"beforeSend")},success:function(t){e(".product-licence-activation").empty().replaceWith(t.template)},complete:function(){r()}})})}(d),o(l),function(t){t.off("click").on("click",function(t){if(t.preventDefault(),1==script_info.is_debug||confirm(licence_message.are_you_sure)){var i=e(this),n=e("#yith-expired-license-count"),a=1*n.data("count"),c=i.parent("td").parent("tr"),u=a-1,o=i.data("product-init"),r=i.data("product-id"),s=i.data("action"),d=e("#activated-products").find(".spinner");jQuery.ajax({type:"POST",url:ajaxurl,data:{action:s,product_init:o,product_id:r,force_delete:!0},beforeSend:function(){e.yith_license_animation(c,d,"beforeSend")},success:function(t){e.yith_license_animation(c,d,999==t.code?"removeLine":"afterSend"),n.removeClass("count-"+a).addClass("count-"+u),n.data("count",u),n.find(".expired-count").empty().text(u)}})}})}(p),t.trigger("wc-enhanced-select-init")};r(),t.on("click",".yit-changelog-button",function(t){e("#TB_window").remove()}),t.on("focusin","input.user-email, input.licence-key",function(){var t=e(this);t.removeClass("require").removeClass("error"),t.hasClass("user-email")&&n.text(""),t.hasClass("licence-key")&&a.text("")}),e(function(){var e=t.find("input.user-email"),i=t.find("input.licence-key");""!=e.val()&&e.trigger("focusout"),""!=i.val()&&i.trigger("focusout")})}(jQuery);