!function(f){"use strict";var o,s={init:function(){this.component.init(),f(document).on("cxFramework:interfaceBuilder:component",this.component.init.bind(this.component)),this.control.init(),f(document).on("cxFramework:interfaceBuilder:control",this.control.init.bind(this.control)),this.controlValidation.init()},component:{tabClass:".cx-tab",accordionClass:".cx-accordion",toggleClass:".cx-toggle",buttonClass:".cx-component__button",contentClass:".cx-settings__content",buttonActiveClass:"active",showClass:"show",localStorage:{},controlConditions:window.cxInterfaceBuilder.conditions||{},controlValues:window.cxInterfaceBuilder.fields||{},conditionState:{},init:function(){this.localStorage=this.getState()||{},this.componentInit(this.tabClass),this.componentInit(this.accordionClass),this.componentInit(this.toggleClass),this.addEvent(),this.conditionsHandleInit()},addEvent:function(){f("body").off("click.cxInterfaceBuilder").on("click.cxInterfaceBuilder",this.tabClass+" "+this.buttonClass+", "+this.toggleClass+" "+this.buttonClass+", "+this.accordionClass+" "+this.buttonClass,this.componentClick.bind(this))},conditionsHandleInit:function(){var n=this;f(window).on("cx-switcher-change",function(t){var e=t.controlName,t=t.controlStatus;n.updateConditionRules(e,t),n.renderConditionRules()}),f(window).on("cx-select-change",function(t){var e=t.controlName,t=t.controlStatus;n.updateConditionRules(e,t),n.renderConditionRules()}),f(window).on("cx-select2-change",function(t){var e=t.controlName,t=t.controlStatus;n.updateConditionRules(e,t),n.renderConditionRules()}),f(window).on("cx-radio-change",function(t){var e=t.controlName,t=t.controlStatus;n.updateConditionRules(e,t),n.renderConditionRules()}),f(window).on("cx-checkbox-change",function(t){var e=t.controlName,t=t.controlStatus,i={};f.each(t[e],function(t,e){i[t]=s.utils.filterBoolValue(e)}),n.updateConditionRules(e,i),n.renderConditionRules()}),f(window).on("cx-control-change",function(t){var e=t.controlName,t=t.controlStatus;n.updateConditionRules(e,t),n.renderConditionRules()}),this.generateConditionRules(),n.renderConditionRules()},getControlNameParts:function(t){return t.match(/([a-zA-Z0-9_-]+)?(!?)$/i)},generateConditionRules:function(){var i=this;f.each(this.controlConditions,function(t,e){f.each(e,function(t,e){t=i.getControlNameParts(t)[1],i.controlValues.hasOwnProperty(t)&&(i.conditionState[t]=i.controlValues[t])})})},updateConditionRules:function(t,e){this.conditionState[t]=e},renderConditionRules:function(){var a=this;f.each(this.controlConditions,function(t,e){var t=f('.cx-control[data-control-name="'+t+'"]'),n=!0;t.addClass("cx-control-hidden"),f.each(e,function(t,i){n=!0;var e=a.getControlNameParts(t);if(t=e[1],e=!!e[2],a.conditionState.hasOwnProperty(t)){switch(typeof i){case"string":a.conditionState[t].toString()===i&&(n=!1);break;case"boolean":a.conditionState[t].toString()===i.toString()&&(n=!1);break;default:"string"==typeof a.conditionState[t]&&("true"===a.conditionState[t]&&(a.conditionState[t]=!0),"false"===a.conditionState[t]&&(a.conditionState[t]=!1)),-1!==i.indexOf(a.conditionState[t])&&(n=!1)}f.isArray(a.conditionState[t])?f.each(a.conditionState[t],function(t,e){if(e&&-1!==i.indexOf(e))return n=!1}):"object"==typeof a.conditionState[t]&&f.each(a.conditionState[t],function(t,e){if(s.utils.filterBoolValue(e)&&-1!==i.indexOf(t))return n=!1})}if(n=e?!n:n)return!1}),n?t.addClass("cx-control-hidden"):t.removeClass("cx-control-hidden")})},componentInit:function(i){var n,a=this,t=f(i),s=null,o=null,r="";t.each(function(t,e){switch(e=f(e),n=e.data("compotent-id"),i){case a.toggleClass:a.localStorage[n]&&a.localStorage[n].length&&(r=a.localStorage[n].join(", ")),f(a.contentClass,e).not(r).addClass(a.showClass).prevAll(a.buttonClass).addClass(a.buttonActiveClass);break;case a.tabClass:case a.accordionClass:a.localStorage[n]?(o=a.localStorage[n][0],s=f('[data-content-id="'+o+'"]',e)):(s=f(a.buttonClass,e).eq(0),o=s.data("content-id")),a.showElement(s,e,o)}})},componentClick:function(t){var e,i=f(t.target),n=i.closest(this.tabClass+", "+this.accordionClass+", "+this.toggleClass),t=new RegExp(this.tabClass+"|"+this.accordionClass+"|"+this.toggleClass),t=n[0].className.match(t)[0].replace(" ","."),a=i.data("content-id"),s=n.data("compotent-id"),o=i.hasClass(this.buttonActiveClass);switch(t){case this.tabClass:o||(this.hideElement(n),this.showElement(i,n,a),this.localStorage[s]=new Array(a),this.setState());break;case this.accordionClass:this.hideElement(n),o?this.localStorage[s]={}:(this.showElement(i,n,a),this.localStorage[s]=new Array(a)),this.setState();break;case this.toggleClass:i.toggleClass(this.buttonActiveClass).nextAll(a).toggleClass(this.showClass),Array.isArray(this.localStorage[s])?-1!==(e=this.localStorage[s].indexOf(a))?this.localStorage[s].splice(e,1):this.localStorage[s].push(a):this.localStorage[s]=new Array(a),this.setState()}return i.blur(),!1},showElement:function(t,e,i){t.addClass(this.buttonActiveClass),e.data("content-id",i),f(i,e).addClass(this.showClass)},hideElement:function(t){var e=t.data("content-id");f('[data-content-id="'+e+'"]',t).removeClass(this.buttonActiveClass),f(e,t).removeClass(this.showClass)},getState:function(){try{return JSON.parse(localStorage.getItem("interface-builder"))}catch(t){return!1}},setState:function(){try{localStorage.setItem("interface-builder",JSON.stringify(this.localStorage))}catch(t){return!1}}},control:{init:function(){this.switcher.init(),this.checkbox.init(),this.radio.init(),this.slider.init(),this.select.init(),this.media.init(),this.colorpicker.init(),this.iconpicker.init(),this.dimensions.init(),this.wysiwyg.init(),this.repeater.init(),this.text.init()},switcher:{switcherClass:".cx-switcher-wrap",trueClass:".cx-input-switcher-true",falseClass:".cx-input-switcher-false",init:function(){f("body").on("click.cxSwitcher",this.switcherClass,this.switchState.bind(this))},switchState:function(t){var e=f(t.currentTarget),i=f(this.trueClass,e),e=f(this.falseClass,e),n=i[0].checked,t=f(t.currentTarget).closest(".cx-control-switcher").data("control-name");i.prop("checked",!n),e.prop("checked",!!n),n=i[0].checked,f(window).trigger({type:"cx-switcher-change",controlName:t,controlStatus:n})}},checkbox:{inputClass:'.cx-checkbox-input[type="hidden"]:not([name*="__i__"])',itemClass:".cx-checkbox-label, .cx-checkbox-item",itemWrapClass:".cx-checkbox-item-wrap",addButtonClass:".cx-checkbox-add-button",customValueInputClass:".cx-checkbox-custom-value",init:function(){f("body").on("click.cxCheckbox",this.itemClass,this.switchState.bind(this)).on("click.cxCheckbox",this.addButtonClass,this.addCustomCheckbox.bind(this)).on("input.cxCheckbox",this.customValueInputClass,this.updateCustomValue.bind(this)),this.resetOnEditTagsPage()},switchState:function(t){var e=f(t.currentTarget).siblings(this.inputClass),i=f(t.target).closest(this.customValueInputClass),n=s.utils.filterBoolValue(e.val()),t=f(t.currentTarget).closest(".cx-control-checkbox"),a=t.data("control-name");i[0]||(e.val(n?"false":"true").attr("checked",!n),t[0]&&(i=s.utils.serializeObject(t),f(window).trigger({type:"cx-checkbox-change",controlName:a,controlStatus:i})))},addCustomCheckbox:function(t){var e=f(t.currentTarget);t.preventDefault(),e.before('<div class="cx-checkbox-item-wrap"><span class="cx-label-content"><input type="hidden" class="cx-checkbox-input" checked value="true"><span class="cx-checkbox-item"><span class="marker dashicons dashicons-yes"></span></span><label class="cx-checkbox-label"><input type="text" class="cx-checkbox-custom-value cx-ui-text"></label></span></div>')},updateCustomValue:function(t){var t=f(t.currentTarget),e=t.val(),i=t.closest(".cx-checkbox-label").siblings(this.inputClass),t=t.closest(".cx-control-checkbox").data("control-name");i.attr("name",e?t+"["+e+"]":"")},resetOnEditTagsPage:function(){var n,a,s=this;-1!==window.location.href.indexOf("edit-tags.php")&&(n=f(s.inputClass),a=[],n[0]&&(n.each(function(){"true"===f(this).val()&&a.push(f(this).attr("name"))}),f(document).ajaxComplete(function(t,e,i){i.data&&-1!==i.data.indexOf("action=add-tag")&&-1===e.responseText.indexOf("wp_error")&&((i=f(s.customValueInputClass))[0]&&i.closest(s.itemWrapClass).remove(),n.each(function(){-1!==a.indexOf(f(this).attr("name"))?f(this).val("true").attr("checked",!0):f(this).val("false").attr("checked",!1)}))})))}},radio:{inputClass:'.cx-radio-input:not([name*="__i__"])',customValueInputClass:".cx-radio-custom-value",init:function(){f("body").on("click.cxRadio",this.inputClass,this.switchState.bind(this)).on("input.cxRadio",this.customValueInputClass,this.updateCustomValue.bind(this)),this.resetOnEditTagsPage()},switchState:function(t){var e=f(t.currentTarget),i=f(t.currentTarget).closest(".cx-control-radio"),t=f(t.currentTarget).siblings(this.customValueInputClass),i=i.data("control-name");t[0]&&t.focus(),f(window).trigger({type:"cx-radio-change",controlName:i,controlStatus:f(e).val()})},updateCustomValue:function(t){var t=f(t.currentTarget),e=t.val();t.siblings(this.inputClass).attr("value",e)},resetOnEditTagsPage:function(){var n,a,s=this;-1!==window.location.href.indexOf("edit-tags.php")&&(n=f(s.inputClass),a=[],n[0]&&(n.each(function(){f(this).prop("checked")&&a.push(f(this).attr("name")+"["+f(this).val()+"]")}),f(document).ajaxComplete(function(t,e,i){i.data&&-1!==i.data.indexOf("action=add-tag")&&-1===e.responseText.indexOf("wp_error")&&((i=f(s.customValueInputClass))[0]&&i.siblings(s.inputClass).val(""),n.each(function(){-1!==a.indexOf(f(this).attr("name")+"["+f(this).val()+"]")?f(this).prop("checked",!0):f(this).prop("checked",!1)}))})))}},slider:{init:function(){f("body").on("input.cxSlider change.cxSlider",".cx-slider-unit, .cx-ui-stepper-input",this.changeHandler.bind(this))},changeHandler:function(t){var t=f(t.currentTarget),a=t.val(),e=t.closest(".cx-slider-wrap"),i=t.closest(".cx-ui-container"),n=i.data("settings")||{},i=f(".cx-ui-stepper-input",i).attr("name"),s=n.range_label||!1,t=t.hasClass("cx-slider-unit")?".cx-ui-stepper-input":".cx-slider-unit";if(f(t,e).val(a),i&&f(window).trigger({type:"cx-control-change",controlName:i,controlStatus:a}),s){var o=f(".cx-slider-range-label",e),r=n.range_labels;if(0==+a)return o.html(r[+a].label),o.css("color",r[+a].color),!1;Object.keys(r).reduce(function(t,e,i,n){return+t<+a&&+a<=+e&&(o.html(r[+e].label),o.css("color",r[+e].color)),e})}}},select:{selectWrapClass:".cx-ui-select-wrapper",selectClass:'.cx-ui-select[data-filter="false"]:not([name*="__i__"])',select2Class:'.cx-ui-select[data-filter="true"]:not([name*="__i__"]), .cx-ui-select[multiple]:not([name*="__i__"])',selectClearClass:".cx-ui-select-clear",init:function(){f(this.selectRender.bind(this)),f(document).on("cx-control-init",this.selectRender.bind(this)).on("click.cxSelect",this.selectClearClass,this.clearSelect)},clearSelect:function(t){t.preventDefault();t=f(this).siblings("select");t.find(":selected").removeAttr("selected"),t.val(null).trigger("change")},selectRender:function(t){t=t._target||f("body");f(this.selectClass,t).each(this.selectInit.bind(this)),f(this.select2Class,t).each(this.select2Init.bind(this))},selectInit:function(t,e){var e=f(e),i=e.attr("id");e.change(function(t){f(window).trigger({type:"cx-select-change",controlName:i,controlStatus:f(t.target).val()})})},select2Init:function(t,e){var i=f(e),n=(i.closest(this.selectWrapClass),i.attr("id")),e={placeholder:i.data("placeholder"),dropdownCssClass:"cx-ui-select2-dropdown"},a=i.data("post-type"),s=i.data("exclude"),o=i.data("action");o&&a&&(e.ajax={url:function(){return ajaxurl+"?action="+o+"&post_type="+i.data("post-type")+"&exclude="+s},dataType:"json"},e.minimumInputLength=3),i.select2(e).on("change.cxSelect2",function(t){f(window).trigger({type:"cx-select2-change",controlName:n,controlStatus:f(t.target).val()})})}},media:{inputClass:'input.cx-upload-input:not([name*="__i__"])',init:function(){f(this.mediaRender.bind(this)),f(document).on("cx-control-init",this.mediaRender.bind(this)),f("body").on("change.cxMedia",this.inputClass,s.control.text.changeHandler.bind(this))},mediaRender:function(t){function m(t,e){return t.length?"both"===e.value_format?(e.multiple||(t=t[0]),JSON.stringify(t)):t.join(","):""}var t=t._target||f("body"),e=f(".cx-upload-button",t),i=f("#post_ID");i.length&&wp.media.view&&wp.media.view.settings&&wp.media.view.settings.post&&!wp.media.view.settings.post.id&&(wp.media.view.settings.post.id=i.val()),e.each(function(){var t=f(this),e=t.closest(".cx-ui-media-wrap"),p={input:f(".cx-upload-input",e),img_holder:f(".cx-upload-preview",e),title_text:t.data("title"),multiple:t.data("multi-upload"),library_type:t.data("library-type"),value_format:t.data("value-format")||"id"},n=wp.media.frames.file_frame=wp.media({title:p.title_text,button:{text:p.title_text},multiple:p.multiple,library:{type:p.library_type}});e.has('input[name*="__i__"]')[0]||(t.off("click.cx-media").on("click.cx-media",function(){return n.open(),!1}),t.data("multi-upload")&&n.on("open",function(){var e=n.state().get("selection"),t=p.input.attr("data-ids-attr");t&&(t=t.split(",")).forEach(function(t){e.add(wp.media.attachment(t))})}),n.on("select",function(){var r=n.state().get("selection").toJSON(),c=0,l=[],d=[],u=f(".cx-all-images-wrap",p.img_holder),h="",i=[];r.forEach(function(t,e){!t.url&&t.id&&i.push(wp.media.attachment(t.id).fetch().then(function(t){r[e]=t}))}),Promise.all(i).then(function(){for(;r[c];){var t=r[c],e=t.id,i=t.url,n=t.mime,a="",s="",o="icon",a="both"===p.value_format?{id:e,url:i}:t[p.value_format];switch(n){case"image/jpeg":case"image/png":case"image/gif":case"image/svg+xml":case"image/webp":s='<img  src="'+(void 0!==t.sizes?(t.sizes.thumbnail||t.sizes.full).url:i)+'" alt="" data-img-attr="'+e+'">',o="image";break;case"application/pdf":s='<span class="dashicons dashicons-media-document"></span>';break;case"image/x-icon":s='<span class="dashicons dashicons-format-image"></span>';break;case"video/mpeg":case"video/mp4":case"video/quicktime":case"video/webm":case"video/ogg":s='<span class="dashicons dashicons-format-video"></span>';break;case"audio/mpeg":case"audio/wav":case"audio/ogg":s='<span class="dashicons dashicons-format-audio"></span>'}h+='<div class="cx-image-wrap cx-image-wrap--'+o+'"><div class="inner"><div class="preview-holder" data-id-attr="'+e+'" data-url-attr="'+i+'"><div class="centered">'+s+'</div></div><a class="cx-remove-image" href="#"><i class="dashicons dashicons-no"></i></a><span class="title">'+t.title+"</span></div></div>",l.push(a),d.push(e),c++}p.input.val(m(l,p)).attr("data-ids-attr",d.join(",")).trigger("change"),u.html(h)})}),e.on("click",".cx-remove-image",function(){var t,e,i,n,a;return t=f(this),e=t.closest(".cx-ui-media-wrap"),i=f(".cx-upload-input",e),t=t.parent().parent(".cx-image-wrap"),f(".preview-holder",t).data("id-attr"),n=i.attr("value"),a=[],n&&(t.remove(),n=[],e.find(".cx-image-wrap").each(function(){var t=f(".preview-holder",this).data("id-attr"),e=f(".preview-holder",this).data("url-attr");switch(a.push(t),p.value_format){case"id":n.push(t);break;case"url":n.push(e);break;case"both":n.push({id:t,url:e})}}),i.attr({value:m(n,p),"data-ids-attr":a.join(",")}).trigger("change")),!1}))}),e[0]&&f(".cx-all-images-wrap",t).sortable({items:"div.cx-image-wrap",cursor:"move",scrollSensitivity:40,forcePlaceholderSize:!0,forceHelperSize:!1,helper:"clone",opacity:.65,placeholder:"cx-media-thumb-sortable-placeholder",start:function(){},stop:function(){},update:function(){var i=[],n=[],t=f(this).parent().siblings(".cx-element-wrap").find("input.cx-upload-input"),e=f(this).parent().siblings(".cx-element-wrap").find("button.cx-upload-button"),a={multiple:e.data("multi-upload"),value_format:e.data("value-format")};f(".cx-image-wrap",this).each(function(){var t=f(".preview-holder",this).data("id-attr"),e=f(".preview-holder",this).data("url-attr");switch(n.push(t),a.value_format){case"id":i.push(t);break;case"url":i.push(e);break;case"both":i.push({id:t,url:e})}}),t.val(m(i,a)).attr("data-ids-attr",n.join(",")).trigger("change")}})}},colorpicker:{inputClass:'input.cx-ui-colorpicker:not([name*="__i__"])',init:function(){f(this.render.bind(this)),f(document).on("cx-control-init",this.render.bind(this))},render:function(t){t=t._target||f("body"),t=f(this.inputClass,t);t[0]&&t.wpColorPicker({change:this.changeHandler})},changeHandler:function(t,e){var i=f(t.target),n=i.attr("name");n&&setTimeout(function(){f(window).trigger({type:"cx-control-change",controlName:n,controlStatus:i.val()})})}},iconpicker:{iconSets:{},iconSetsKey:"cx-icon-sets",init:function(){f(this.setIconsSets.bind(this,window.CxIconSets)),f(this.render.bind(this)),f(document).on("cx-control-init",this.render.bind(this))},setIconsSets:function(t){var i=this;t&&(t=t.response?t.response.CxIconSets:t,f.each(t,function(t,e){i.iconSets[t]=e}),i.setState(i.iconSetsKey,i.iconSets))},getIconsSets:function(){var t=this.getState(this.iconSetsKey);t&&(this.iconSets=t)},render:function(t){var e,i,n,t=t._target||f("body"),t=f('.cx-ui-iconpicker:not([name*="__i__"])',t),a=this;t[0]&&(this.getIconsSets(),t.each(function(){e=f(this),i=e.data("set"),n=a.iconSets[i],e.length&&n.icons&&e.iconpicker({icons:n.icons,iconBaseClass:n.iconBase,iconClassPrefix:n.iconPrefix,animation:!1,fullClassFormatter:function(t){return n.iconBase+" "+n.iconPrefix+t}}).on("iconpickerUpdated",function(){f(this).trigger("change")}),n&&f("head").append('<link rel="stylesheet" type="text/css" href="'+n.iconCSS+'"">')}))},getState:function(t){try{return JSON.parse(window.sessionStorage.getItem(t))}catch(t){return!1}},setState:function(t,e){try{window.sessionStorage.setItem(t,JSON.stringify(e))}catch(t){return!1}}},dimensions:{container:".cx-ui-dimensions",isLinked:".cx-ui-dimensions__is-linked",units:".cx-ui-dimensions__unit",unitsInput:'input[name*="[units]"]',linkedInput:'input[name*="[is_linked]"]',valuesInput:".cx-ui-dimensions__val",init:function(){f("body").on("click",this.isLinked,{self:this},this.switchLinked).on("click",this.units,{self:this},this.switchUnits).on("input",this.valuesInput+".is-linked",{self:this},this.changeLinked)},render:function(t){},switchLinked:function(t){var t=t.data.self,e=f(this),i=e.closest(t.container),n=i.find(t.linkedInput),i=i.find(t.valuesInput),t=n.val();0===parseInt(t)?(n.val(1),e.addClass("is-linked"),i.addClass("is-linked")):(n.val(0),e.removeClass("is-linked"),i.removeClass("is-linked"))},switchUnits:function(t){var t=t.data.self,e=f(this),i=e.data("unit"),n=e.closest(t.container),a=n.find(t.unitsInput),s=n.find(t.valuesInput),n=n.data("range");e.hasClass("is-active")||(e.addClass("is-active").siblings(t.units).removeClass("is-active"),a.val(i),s.attr({min:n[i].min,max:n[i].max,step:n[i].step}))},changeLinked:function(t){var t=t.data.self,e=f(this),i=e.closest(".cx-ui-dimensions__values");f(t.valuesInput,i).val(e.val())}},wysiwyg:{defaultEditorSettings:{tinymce:{wpautop:!0,toolbar1:"formatselect,bold,italic,bullist,numlist,blockquote,alignleft,aligncenter,alignright,link,wp_more,spellchecker,wp_adv,dfw",toolbar2:"strikethrough,hr,forecolor,pastetext,removeformat,charmap,outdent,indent,undo,redo,wp_help"},quicktags:{buttons:"strong,em,link,block,del,ins,img,ul,ol,li,code,more,close,dfw"},mediaButtons:!0},editorSettings:!1,init:function(){var t=this;f(window).on("load",function(){setTimeout(function(){f(t.render.bind(t))})}),f(document).on("cx-control-init",this.render.bind(this)),f(window).on("cx-repeater-sortable-stop",this.reInit.bind(this))},render:function(t){var n=this,t=t._target||f("body"),t=f('textarea.cx-ui-wysiwyg:not([name*="__i__"])',t);t[0]&&t.each(function(){var e,i=f(this),t=i.attr("id");i.data("init")||((void 0!==window.wp.editor.initialize?window.wp.editor:window.wp.oldEditor).initialize(t,n.getEditorSettings()),(e=window.tinymce.get(t))&&e.on("change",function(t){f(window).trigger({type:"cx-control-change",controlName:i.attr("name"),controlStatus:e.getContent()})}),n.addSaveTriggerOnEditTagsPage(t),i.data("init",!0))})},reInit:function(t){var e=this,t=t._item,t=f("textarea.wp-editor-area",t);t[0]&&t.each(function(){var t=f(this).attr("id");void 0!==window.wp.editor.initialize?(window.wp.editor.remove(t),window.wp.editor.initialize(t,e.getEditorSettings())):(window.wp.oldEditor.remove(t),window.wp.oldEditor.initialize(t,e.getEditorSettings()))})},getEditorSettings:function(){return this.editorSettings||(this.editorSettings=this.defaultEditorSettings,window.tinyMCEPreInit&&(window.tinyMCEPreInit.mceInit&&window.tinyMCEPreInit.mceInit.cx_wysiwyg&&(this.editorSettings.tinymce=window.tinyMCEPreInit.mceInit.cx_wysiwyg),window.tinyMCEPreInit.qtInit&&window.tinyMCEPreInit.qtInit.cx_wysiwyg&&(this.editorSettings.quicktags=window.tinyMCEPreInit.qtInit.cx_wysiwyg)),this.editorSettings)},addSaveTriggerOnEditTagsPage:function(t){var n;-1!==window.location.href.indexOf("edit-tags.php")&&window.tinymce&&((n=window.tinymce.get(t))&&n.on("change",function(){n.save()}),f(document).ajaxComplete(function(t,e,i){i.data&&-1!==i.data.indexOf("action=add-tag")&&-1===e.responseText.indexOf("wp_error")&&n.setContent("")}))}},repeater:{repeaterContainerClass:".cx-ui-repeater-container",repeaterListClass:".cx-ui-repeater-list",repeaterItemClass:".cx-ui-repeater-item",repeaterItemHandleClass:".cx-ui-repeater-actions-box",repeaterTitleClass:".cx-ui-repeater-title",addItemButtonClass:".cx-ui-repeater-add",removeItemButtonClass:".cx-ui-repeater-remove",removeConfirmItemButtonClass:".cx-ui-repeater-remove__confirm",removeCancelItemButtonClass:".cx-ui-repeater-remove__cancel",copyItemButtonClass:".cx-ui-repeater-copy",toggleItemButtonClass:".cx-ui-repeater-toggle",minItemClass:"cx-ui-repeater-min",sortablePlaceholderClass:"sortable-placeholder",init:function(){f(this.addEvents.bind(this))},addEvents:function(){f("body").on("click",this.addItemButtonClass,{self:this},this.addItem).on("click",this.removeItemButtonClass,{self:this},this.showRemoveItemTooltip).on("click",this.removeConfirmItemButtonClass,{self:this},this.removeItem).on("click",this.removeCancelItemButtonClass,{self:this},this.hideRemoveItemTooltip).on("click",this.copyItemButtonClass,{self:this},this.copyItem).on("click",this.toggleItemButtonClass,{self:this},this.toggleItem).on("change",this.repeaterListClass+" input, "+this.repeaterListClass+" textarea, "+this.repeaterListClass+" select",{self:this},this.changeWrapperLable).on("sortable-init",{self:this},this.sortableItem),f(document).on("cx-control-init",{self:this},this.sortableItem),this.triggers()},triggers:function(t){return f("body").trigger("sortable-init"),t&&f(document).trigger("cx-control-init",{target:t}),this},addItem:function(t){var e=t.data.self,i=f(this).prev(e.repeaterListClass),n=i.data("index"),a=i.data("name"),a=wp.template(a),s=i.data("widget-id"),o={index:n},r=i.parent().closest(e.repeaterListClass);(s="__i__"!==s?s:i.attr("id"))&&(o.widgetId=s),r.length&&(o.parentIndex=parseInt(r.data("index"),10)-1),i.append(a(o)),i.data("index",++n),e.triggers(f(e.repeaterItemClass+":last",i)).stopDefaultEvent(t)},copyItem:function(t){var a,e=t.data.self,i=f(this).closest(e.repeaterItemClass),n=f(this).closest(e.repeaterListClass),s=n.parent().closest(e.repeaterListClass),o=i.data("item-index"),r=n.data("index"),c=n.data("name"),l=n.data("widget-id"),c=wp.template(c),d={index:r};(l="__i__"!==l?l:n.attr("id"))&&(d.widgetId=l),s.length&&(d.parentIndex=parseInt(s.data("index"),10)-1),a=f(c(d)),i.find(".cx-ui-repeater-item-control").each(function(){var t=f(this).data("repeater-control-name"),e=f(this).find('[name^="'+l+"[item-"+o+"]["+t+']"]'),e=(e.filter(".cx-checkbox-input, .cx-radio-input, .cx-input-switcher").length?e.each(function(){var t=f(this),e=t.prop("checked"),i=t.val(),n=t.attr("name").replace("[item-"+o+"]","[item-"+r+"]");t.hasClass("cx-checkbox-input")?a.find('[name="'+n+'"]').val(i).attr("checked",e):a.find('[name="'+n+'"][value="'+i+'"]').prop("checked",e)}):e.filter(".cx-ui-select").length?e.data("filter")?a.find('.cx-ui-select[name^="'+l+"[item-"+r+"]["+t+']"]').html(e.html()):a.find('.cx-ui-select[name^="'+l+"[item-"+r+"]["+t+']"]').val(e.val()):a.find('[name="'+l+"[item-"+r+"]["+t+']"]').val(e.val()),f(this).find(".cx-ui-media-wrap"));e.length&&(e=e.find(".cx-upload-preview").html(),a.find('.cx-ui-repeater-item-control[data-repeater-control-name="'+t+'"] .cx-upload-preview').html(e))}),a.find(".cx-ui-repeater-title").html(i.find(".cx-ui-repeater-title").html()),i.after(a),r++,n.data("index",r),e.triggers(a).stopDefaultEvent(t)},showRemoveItemTooltip:function(t){var e=t.data.self;f(this).find(".cx-tooltip").addClass("cx-tooltip--show"),e.stopDefaultEvent(t)},hideRemoveItemTooltip:function(t){var e=t.data.self;f(this).closest(".cx-tooltip").removeClass("cx-tooltip--show"),e.stopDefaultEvent(t)},removeItem:function(t){var e=t.data.self,i=f(this).closest(e.repeaterListClass);e.applyChanges(i),f(this).closest(e.repeaterItemClass).remove(),e.triggers().stopDefaultEvent(t)},toggleItem:function(t){var e=t.data.self;f(this).closest(e.repeaterItemClass).toggleClass(e.minItemClass),e.stopDefaultEvent(t)},sortableItem:function(t){var i,n=t.data.self;f(n.repeaterListClass).each(function(t,e){i=f(e),f(e).data("sortable-init")?i.sortable("refresh"):i.sortable({items:n.repeaterItemClass,handle:n.repeaterItemHandleClass,cursor:"move",scrollSensitivity:40,forcePlaceholderSize:!0,forceHelperSize:!1,distance:2,tolerance:"pointer",helper:function(t,e){return e.clone().find(":input").attr("name",function(t,e){return"sort_"+parseInt(1e5*Math.random(),10).toString()+"_"+e}).end()},start:function(t,e){f(window).trigger({type:"cx-repeater-sortable-start",_item:e.item})},stop:function(t,e){f(window).trigger({type:"cx-repeater-sortable-stop",_item:e.item})},opacity:.65,placeholder:n.sortablePlaceholderClass,create:function(){i.data("sortable-init",!0)},update:function(t,e){t=f(t.target);n.applyChanges(t)}})})},changeWrapperLable:function(t){var e=t.data.self,i=f(e.repeaterListClass).data("title-field"),n=f(this);i&&n.closest("."+i+"-wrap")[0]&&(i=n.val(),n=n.closest(e.repeaterItemClass),f(e.repeaterTitleClass,n).html(i)),e.stopDefaultEvent(t)},applyChanges:function(t){return void 0!==wp.customize&&f("input[name]:first, select[name]:first",t).change(),this},stopDefaultEvent:function(t){return t.preventDefault(),t.stopImmediatePropagation(),t.stopPropagation(),this}},text:{inputClass:'.cx-ui-text:not([name*="__i__"]), .cx-ui-textarea:not([name*="__i__"])',init:function(){f("body").on("input.cxText, change.cxText",this.inputClass,this.changeHandler.bind(this))},changeHandler:function(t){var t=f(t.currentTarget),e=t.attr("name");e&&f(window).trigger({type:"cx-control-change",controlName:e,controlStatus:t.val()})}}},utils:{serializeObject:function(t){var a=this,s={},e={},o={validate:/^[a-zA-Z_][a-zA-Z0-9_-]*(?:\[(?:\d*|[a-zA-Z0-9\s_-]+)\])*$/,key:/[a-zA-Z0-9\s_-]+|(?=\[\])/g,push:/^$/,fixed:/^\d+$/,named:/^[a-zA-Z0-9\s_-]+$/};return this.build=function(t,e,i){return t[e]=i,t},this.push_counter=function(t){return void 0===e[t]&&(e[t]=0),e[t]++},t=("FORM"===t[0].tagName?t:t.find("input, textarea, select")).serializeArray(),f.each(t,function(){var t,e,i,n;if(o.validate.test(this.name)){for(e=this.name.match(o.key),i=this.value,n=this.name;void 0!==(t=e.pop());)n=n.replace(new RegExp("\\["+t+"\\]$"),""),t.match(o.push)?i=a.build([],a.push_counter(n),i):(t.match(o.fixed)||t.match(o.named))&&(i=a.build({},t,i));s=f.extend(!0,s,i)}}),s},filterBoolValue:function(t){var e=+t;return isNaN(e)?!!String(t).toLowerCase().replace(!1,""):!!e}},controlValidation:{errorMessages:{required:window.cxInterfaceBuilder.i18n.requiredError,min:window.cxInterfaceBuilder.i18n.minError,max:window.cxInterfaceBuilder.i18n.maxError,step:window.cxInterfaceBuilder.i18n.stepError},init:function(){this.isBlockEditor()?this.onBlockEditorSavePost():f("#post, #edittag, #your-profile, .cx-form").on("submit",this.onSubmitForm.bind(this)),s.filters.addFilter("cxInterfaceBuilder/form/validation",this.requiredValidation.bind(this)),s.filters.addFilter("cxInterfaceBuilder/form/validation",this.numberValidation.bind(this)),f(window).on("cx-control-change cx-checkbox-change cx-radio-change cx-select-change cx-select2-change",this.removeFieldErrorOnChange.bind(this)),f(".cx-control-repeater").on("focusin",this.removeRepeaterErrorOnChange.bind(this))},isBlockEditor:function(){return f("body").hasClass("block-editor-page")},onBlockEditorSavePost:function(){var e=this,t=wp.data.dispatch("core/editor"),i=t.savePost;t.savePost=function(t){(t=t||{}).isAutosave||t.isPreview?i(t):(e.beforeValidation(),s.filters.applyFilters("cxInterfaceBuilder/form/validation",!0,f("#editor"))?i(t):e.scrollToFirstErrorField())}},onSubmitForm:function(t){this.beforeValidation(),s.filters.applyFilters("cxInterfaceBuilder/form/validation",!0,f(t.target))||(this.scrollToFirstErrorField(),t.preventDefault())},beforeValidation:function(){this.removeAllFieldsErrors(),void 0!==window.tinyMCE&&window.tinyMCE.triggerSave()},requiredValidation:function(t,e){if(!t)return t;var n=this,e=e.find(".cx-control-required:not(.cx-control-hidden)"),a=!1;return e.length?(e.each(function(){var t=f(this),e=t.data("control-name"),i=!1,i=t.hasClass("cx-control-checkbox")||t.hasClass("cx-control-radio")?!!t.find('[name^="'+e+'"]').filter(":checked").length:t.hasClass("cx-control-repeater")?!!t.find(".cx-ui-repeater-item").length:t.find('[name^="'+e+'"]').val();(i=Array.isArray(i)?!!i.length:i)||(n.addFieldError(t,n.errorMessages.required),a=!0)}),!a&&t):t},numberValidation:function(t,e){if(!t)return t;if(!this.isBlockEditor())return t;var s=this,e=e.find(".cx-control-stepper:not(.cx-control-hidden)"),o=!1;return e.length?(e.each(function(){var t=f(this),e=t.find("input.cx-ui-stepper-input"),i=e.attr("min"),n=e.attr("max"),a=e.attr("step"),e=e.val();""!==i&&e&&Number(e)<Number(i)?(s.addFieldError(t,s.errorMessages.min.replace("%s",i)),o=!0):""!==n&&e&&Number(e)>Number(n)?(s.addFieldError(t,s.errorMessages.max.replace("%s",n)),o=!0):""!==a&&e&&0!=Number(e)%Number(a)&&(s.addFieldError(t,s.errorMessages.step.replace("%s",a)),o=!0)}),!o&&t):t},addFieldError:function(t,e){var i=t.find(".cx-control__error");i.length?i.html(e):t.find(".cx-control__content").append('<div class="cx-control__error">'+e+"</div>"),t.addClass("cx-control--error")},removeFieldError:function(t){t.find(".cx-control__error").remove(),t.removeClass("cx-control--error")},removeFieldErrorOnChange:function(t){t=f('.cx-control[data-control-name="'+t.controlName+'"]');t.hasClass("cx-control--error")&&this.removeFieldError(t)},removeRepeaterErrorOnChange:function(t){t=f(t.currentTarget).closest(".cx-control");t.hasClass("cx-control--error")&&this.removeFieldError(t)},removeAllFieldsErrors:function(){var t=this,e=f(".cx-control--error");e.length&&e.each(function(){t.removeFieldError(f(this))})},scrollToFirstErrorField:function(){var t=f(".cx-control--error").first(),e=(t.is(":visible")||((i=t.closest(".cx-component")).length&&(e=t.closest(".cx-settings__content").attr("id"),i.find('[data-content-id="#'+e+'"]').trigger("click")),(i=t.closest(".postbox.closed")).length&&i.find("button.handlediv").trigger("click")),f("html, body")),i=t.offset().top,n=40;this.isBlockEditor()&&(f("body").hasClass("is-fullscreen-mode")?n+=20:n+=60,t.closest(".interface-interface-skeleton__sidebar").length?(e=f("#editor .interface-interface-skeleton__sidebar"),n+=50):e=f("#editor .interface-interface-skeleton__content"),i+=e.scrollTop()),e.stop().animate({scrollTop:i-n},500)}},filters:(o={},{addFilter:function(t,e){o.hasOwnProperty(t)||(o[t]=[]),o[t].push(e)},applyFilters:function(t,e,i){if(!o.hasOwnProperty(t))return e;void 0===i&&(i=[]);for(var n=o[t],a=n.length,s=0;s<a;s++)"function"==typeof n[s]&&(e=n[s](e,i));return e}})};s.init(),window.cxInterfaceBuilderAPI=s}(jQuery,window._);